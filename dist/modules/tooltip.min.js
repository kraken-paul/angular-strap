/**
 * angular-strap
 * @version v2.0.2 - 2014-04-29
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("mgcrea.ngStrap.tooltip",["mgcrea.ngStrap.helpers.dimensions"]).provider("$tooltip",function(){var e=this.defaults={animation:"am-fade",prefixClass:"tooltip",prefixEvent:"tooltip",container:!1,placement:"top",template:"tooltip/tooltip.tpl.html",contentTemplate:!1,trigger:"hover focus",keyboard:!1,html:!1,show:!1,title:"",type:"",delay:0};this.$get=["$window","$rootScope","$compile","$q","$templateCache","$http","$animate","$timeout","dimensions","$$rAF",function(t,o,n,i,r,a,l,s,c,u){function p(t,i){function r(){return"body"===g.container?c.offset(t[0]):c.position(t[0])}function a(e,t,o,n){var i,r=e.split("-");switch(r[0]){case"right":i={top:t.top+t.height/2-n/2,left:t.left+t.width};break;case"bottom":i={top:t.top+t.height,left:t.left+t.width/2-o/2};break;case"left":i={top:t.top+t.height/2-n/2,left:t.left-o};break;default:i={top:t.top-n,left:t.left+t.width/2-o/2}}if(!r[1])return i;if("top"===r[0]||"bottom"===r[0])switch(r[1]){case"left":i.left=t.left;break;case"right":i.left=t.left+t.width-o}else if("left"===r[0]||"right"===r[0])switch(r[1]){case"top":i.top=t.top-n;break;case"bottom":i.top=t.top+t.height}return i}var s={},p=t[0].nodeName.toLowerCase(),g=s.$options=angular.extend({},e,i);s.$promise=h(g.template);var y=s.$scope=g.scope&&g.scope.$new()||o.$new();g.delay&&angular.isString(g.delay)&&(g.delay=parseFloat(g.delay)),g.title&&(s.$scope.title=g.title),y.$hide=function(){y.$$postDigest(function(){s.hide()})},y.$show=function(){y.$$postDigest(function(){s.show()})},y.$toggle=function(){y.$$postDigest(function(){s.toggle()})},s.$isShown=y.$isShown=!1;var v,w;g.contentTemplate&&(s.$promise=s.$promise.then(function(e){var t=angular.element(e);return h(g.contentTemplate).then(function(e){var o=f('[ng-bind="content"]',t[0]);return o.length||(o=f('[ng-bind="title"]',t[0])),o.removeAttr("ng-bind").html(e),t[0].outerHTML})}));var b,k,S,T;return s.$promise.then(function(e){angular.isObject(e)&&(e=e.data),g.html&&(e=e.replace(m,'ng-bind-html="')),e=d.apply(e),S=e,b=n(e),s.init()}),s.init=function(){g.delay&&angular.isNumber(g.delay)&&(g.delay={show:g.delay,hide:g.delay}),"self"===g.container?T=t:g.container&&(T=f(g.container));var e=g.trigger.split(" ");angular.forEach(e,function(e){"click"===e?t.on("click",s.toggle):"manual"!==e&&(t.on("hover"===e?"mouseenter":"focus",s.enter),t.on("hover"===e?"mouseleave":"blur",s.leave),"button"===p&&"hover"!==e&&t.on($?"touchstart":"mousedown",s.$onFocusElementMouseDown))}),g.show&&y.$$postDigest(function(){"focus"===g.trigger?t[0].focus():s.show()})},s.destroy=function(){for(var e=g.trigger.split(" "),o=e.length;o--;){var n=e[o];"click"===n?t.off("click",s.toggle):"manual"!==n&&(t.off("hover"===n?"mouseenter":"focus",s.enter),t.off("hover"===n?"mouseleave":"blur",s.leave),"button"===p&&"hover"!==n&&t.off($?"touchstart":"mousedown",s.$onFocusElementMouseDown))}k&&(k.remove(),k=null),y.$destroy()},s.enter=function(){return clearTimeout(v),w="in",g.delay&&g.delay.show?void(v=setTimeout(function(){"in"===w&&s.show()},g.delay.show)):s.show()},s.show=function(){y.$emit(g.prefixEvent+".show.before",s);var e=g.container?T:null,o=g.container?null:t;k&&k.remove(),k=s.$element=b(y,function(){}),k.css({top:"0px",left:"0px",display:"block"}).addClass(g.placement),g.animation&&k.addClass(g.animation),g.type&&k.addClass(g.prefixClass+"-"+g.type),l.enter(k,e,o,function(){y.$emit(g.prefixEvent+".show",s)}),s.$isShown=y.$isShown=!0,y.$$phase||y.$root.$$phase||y.$digest(),u(s.$applyPlacement),g.keyboard&&("focus"!==g.trigger?(s.focus(),k.on("keyup",s.$onKeyUp)):t.on("keyup",s.$onFocusKeyUp))},s.leave=function(){return clearTimeout(v),w="out",g.delay&&g.delay.hide?void(v=setTimeout(function(){"out"===w&&s.hide()},g.delay.hide)):s.hide()},s.hide=function(e){return s.$isShown?(y.$emit(g.prefixEvent+".hide.before",s),l.leave(k,function(){y.$emit(g.prefixEvent+".hide",s)}),s.$isShown=y.$isShown=!1,y.$$phase||y.$root.$$phase||y.$digest(),g.keyboard&&null!==k&&k.off("keyup",s.$onKeyUp),e&&"focus"===g.trigger?t[0].blur():void 0):void 0},s.toggle=function(){s.$isShown?s.leave():s.enter()},s.focus=function(){k[0].focus()},s.$applyPlacement=function(){if(k){var e=r(),t=k.prop("offsetWidth"),o=k.prop("offsetHeight"),n=/\s?auto?\s?/i,i=n.test(s.$options.placement);if(i){var l=s.$element.parent(),c=e,u=t,p=o,f=s.$options.placement,h=document.documentElement.scrollTop||document.body.scrollTop,d="body"==s.$options.container?window.innerWidth:l.outerWidth(),$="body"==s.$options.container?window.innerHeight:l.outerHeight(),m="body"==s.$options.container?0:l.offset().left,y="top";y="bottom"==y&&c.top+c.height+p-h>$?"top":"top"==y&&c.top-h-p<0?"bottom":"right"==y&&c.right+u>d?"left":"left"==y&&c.left-u<m?"right":y,s.$element.removeClass(f).addClass(y),g.placement=y}var v=a(g.placement,e,t,o);v.top+="px",v.left=v.left<0?0:v.left,v.left+="px",k.css(v)}},s.$onKeyUp=function(e){27===e.which&&s.hide()},s.$onFocusKeyUp=function(e){27===e.which&&t[0].blur()},s.$onFocusElementMouseDown=function(e){e.preventDefault(),e.stopPropagation(),s.$isShown?t[0].blur():t[0].focus()},s}function f(e,t){return angular.element((t||document).querySelectorAll(e))}function h(e){return i.when(r.get(e)||a.get(e)).then(function(t){return angular.isObject(t)?(r.put(e,t.data),t.data):t})}var d=String.prototype.trim,$="createTouch"in t.document,m=/ng-bind="/gi;return p}]}).directive("bsTooltip",["$window","$location","$sce","$tooltip","$$rAF",function(e,t,o,n,i){return{restrict:"EAC",scope:!0,link:function(e,t,r){var a={scope:e};angular.forEach(["template","contentTemplate","placement","container","delay","trigger","keyboard","html","animation","type"],function(e){angular.isDefined(r[e])&&(a[e]=r[e])}),angular.forEach(["title"],function(t){r[t]&&r.$observe(t,function(n,r){e[t]=o.trustAsHtml(n),angular.isDefined(r)&&i(function(){l&&l.$applyPlacement()})})}),r.bsTooltip&&e.$watch(r.bsTooltip,function(t,o){angular.isObject(t)?angular.extend(e,t):e.title=t,angular.isDefined(o)&&i(function(){l&&l.$applyPlacement()})},!0);var l=n(t,a);e.$on("$destroy",function(){l.destroy(),a=null,l=null})}}}]);